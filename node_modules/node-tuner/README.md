# node-tuner

This is a native Node.js module implementing the [Linux DVB API v5.10](https://linuxtv.org/downloads/v4l-dvb-apis/uapi/dvb/dvbapi.html)

The module exposes a simple JavaScript API to control the tuner and monitor its state, either via events or explicitely.

# How to build

## If your host is linux and you run there as well

Node.js Deps: node-gyp

```
$ npm install
```

## Cross-compilation for Raspberry Pi on a linux host

1. Grab the tool chain from https://github.com/raspberrypi/tools/tree/master/arm-bcm2708/arm-rpi-4.9.3-linux-gnueabihf and add to your path
2. Build the module using helper script  ```$ ./scripts/build-for-arm.sh```

## On target pi

Deps: rsync
Node.js Deps: node-gyp 

1. Sync code with folder on target using helder script: ```$ ./scripts/sync.sh RasPi_IP```
2. Run on probe ```$ npm install``` 
3. Sync into your host again to fetch the binaries for packaging

## How to run and test

NOTICE: To make your DVB Stick work you will probably need the correct firmware loaded. For example the TT-TVStick CT2-4400 requires the ```firmware/dvb-demod-si2168-b40-01.fw``` to be present in /lib/firmware

You may find information on your Stick at [LinuxTV wiki](https://linuxtv.org/wiki/index.php/DVB-T2_USB_Devices)

Get test test deps with ```$npm install -g babel-cli tape faucet```

```bash
$ npm test

> node-tuner@1.16.10 test /home/pi/node-tuner
> babel-node tests/simple.js  | faucet

✓ Retrieve available tuners
✓ Retrieve tuner information
✓ Start tuner and stop after some seconds (10s)
✓ Record some seconds (10s) of the multiplex transport stream
✓ Track the bitrate for some seconds (10s)
# tests 5
# pass  5
✓ ok
```
